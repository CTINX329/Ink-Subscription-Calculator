<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ink Subscription Calculator (Internal)</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
      background: #1a1a1a;
      padding: 20px;
      margin: 0;
    }
    .calc-container {
      max-width: 1000px;
      margin: 0 auto;
    }
    .calc-card {
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 14px;
      padding: 20px;
      margin: 14px 0;
      background: #242424;
      color: #e8e8e8;
    }
    .calc-card h2 {
      margin: 0 0 8px;
      font-size: 20px;
      color: #fff;
    }
    .calc-card h3 {
      margin: 0 0 12px;
      font-size: 16px;
      color: #ccc;
    }
    .calc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .calc-grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 14px;
    }
    .calc-grid-4 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 800px) {
      .calc-grid, .calc-grid-3, .calc-grid-4 {
        grid-template-columns: 1fr;
      }
    }
    .calc-field {
      margin-bottom: 14px;
    }
    .calc-label {
      display: block;
      font-size: 12px;
      color: #999;
      margin: 0 0 6px;
      font-weight: 600;
    }
    .calc-input,
    .calc-select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.15);
      outline: none;
      font-size: 14px;
      background: #1a1a1a;
      color: #fff;
      font-family: inherit;
    }
    .calc-input:focus,
    .calc-select:focus {
      border-color: rgba(255,255,255,.3);
    }
    .calc-input::placeholder {
      color: #666;
    }
    .calc-input:disabled,
    .calc-select:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .calc-muted {
      font-size: 12px;
      color: #777;
      line-height: 1.4;
      margin-top: 4px;
    }
    .calc-pill {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.1);
      font-size: 11px;
      color: #aaa;
      background: rgba(255,255,255,.05);
      margin: 3px 3px 3px 0;
    }
    .calc-pill-system {
      background: rgba(80,200,120,.15);
      border-color: rgba(80,200,120,.3);
      color: #6fcf97;
    }
    .calc-pill-excluded {
      background: rgba(200,80,80,.15);
      border-color: rgba(200,80,80,.3);
      color: #cf6f6f;
    }
    .calc-result {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .calc-result-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    .calc-result-4 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 800px) {
      .calc-result, .calc-result-3, .calc-result-4 {
        grid-template-columns: 1fr;
      }
    }
    .calc-kpi {
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 14px;
      background: rgba(255,255,255,.03);
    }
    .calc-kpi-customer {
      background: rgba(80,160,255,.1);
      border-color: rgba(80,160,255,.25);
    }
    .calc-kpi-internal {
      background: rgba(255,160,80,.1);
      border-color: rgba(255,160,80,.25);
    }
    .calc-kpi-profit {
      background: rgba(80,200,120,.1);
      border-color: rgba(80,200,120,.25);
    }
    .calc-kpi-warning {
      background: rgba(255,80,80,.1);
      border-color: rgba(255,80,80,.25);
    }
    .calc-kpi-label {
      font-size: 12px;
      color: #888;
    }
    .calc-kpi-value {
      font-size: 24px;
      font-weight: 700;
      margin-top: 4px;
      color: #fff;
    }
    .calc-kpi-sub {
      font-size: 12px;
      color: #777;
      margin-top: 6px;
      line-height: 1.4;
    }
    .calc-divider {
      height: 1px;
      background: rgba(255,255,255,.08);
      margin: 18px 0;
    }
    .calc-btn {
      padding: 11px 20px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.15);
      background: #fff;
      color: #111;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }
    .calc-btn:hover {
      background: #e0e0e0;
    }
    .calc-btn-secondary {
      background: #333;
      color: #fff;
      border-color: rgba(255,255,255,.2);
    }
    .calc-btn-secondary:hover {
      background: #444;
    }
    .calc-section-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #666;
      margin-bottom: 10px;
      font-weight: 600;
    }
    .calc-warn {
      border-left: 4px solid rgba(255,160,80,.6);
      padding: 12px;
      margin-top: 12px;
      background: rgba(255,160,80,.08);
      border-radius: 0 10px 10px 0;
      color: #ccc;
    }
    .calc-alert {
      border-left: 4px solid rgba(255,80,80,.6);
      padding: 12px;
      margin-top: 12px;
      background: rgba(255,80,80,.08);
      border-radius: 0 10px 10px 0;
      color: #ccc;
    }
    .calc-info {
      border-left: 4px solid rgba(80,160,255,.6);
      padding: 12px;
      margin-top: 12px;
      background: rgba(80,160,255,.08);
      border-radius: 0 10px 10px 0;
      color: #ccc;
    }
    
    /* Toggle switch */
    .toggle-container {
      display: flex;
      gap: 0;
      background: #1a1a1a;
      border-radius: 10px;
      padding: 4px;
      width: fit-content;
    }
    .toggle-btn {
      padding: 10px 20px;
      border: none;
      background: transparent;
      color: #888;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .toggle-btn.active {
      background: #fff;
      color: #111;
    }
    .toggle-btn:hover:not(.active) {
      color: #ccc;
    }
    
    /* Conditional sections */
    .customer-mode-section {
      display: none;
    }
    .customer-mode-section.active {
      display: block;
    }
    
    /* Scenario table */
    .scenario-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 10px;
    }
    .scenario-table th,
    .scenario-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,.06);
      color: #ccc;
    }
    .scenario-table th {
      font-weight: 600;
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    .scenario-table tr:last-child td {
      border-bottom: none;
    }
    .scenario-table .highlight {
      background: rgba(80,200,120,.1);
    }
    .scenario-table .warning {
      background: rgba(255,180,80,.1);
    }
    .scenario-table .danger {
      background: rgba(255,80,80,.15);
    }
    
    /* Copy output box */
    .copy-output {
      background: #1a1a1a;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 10px;
      padding: 16px;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
      color: #aaa;
      max-height: 300px;
      overflow-y: auto;
    }
    
    /* Header badge */
    .internal-badge {
      display: inline-block;
      background: rgba(255,80,80,.2);
      color: #ff9999;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 10px;
      vertical-align: middle;
    }
    
    /* Escalation timeline */
    .escalation-timeline {
      display: flex;
      gap: 0;
      margin-top: 12px;
    }
    .escalation-step {
      flex: 1;
      padding: 12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
      position: relative;
    }
    .escalation-step:first-child {
      border-radius: 10px 0 0 10px;
    }
    .escalation-step:last-child {
      border-radius: 0 10px 10px 0;
    }
    .escalation-step-title {
      font-size: 11px;
      text-transform: uppercase;
      color: #888;
      margin-bottom: 6px;
    }
    .escalation-step-action {
      font-size: 13px;
      color: #ccc;
      line-height: 1.4;
    }
    .escalation-step.warning {
      background: rgba(255,180,80,.1);
      border-color: rgba(255,180,80,.3);
    }
    .escalation-step.danger {
      background: rgba(255,80,80,.1);
      border-color: rgba(255,80,80,.3);
    }
    @media (max-width: 800px) {
      .escalation-timeline {
        flex-direction: column;
      }
      .escalation-step:first-child {
        border-radius: 10px 10px 0 0;
      }
      .escalation-step:last-child {
        border-radius: 0 0 10px 10px;
      }
    }
  </style>
</head>
<body>
  <div class="calc-container">
    
    <!-- Header -->
    <div class="calc-card">
      <h2>Ink Subscription Calculator <span class="internal-badge">Internal Use Only</span></h2>
      <div class="calc-muted">
        Size flat-rate ink subscriptions for new or existing customers. Track COGS, margin, and overage controls.
      </div>
      <div style="margin-top: 14px;">
        <span class="calc-section-label">Eligible Ink Systems</span><br>
        <span class="calc-pill calc-pill-system">Paper Series</span>
        <span class="calc-pill calc-pill-system">Direct/Indirect Thermal</span>
        <span class="calc-pill calc-pill-system">Laminating Films</span>
      </div>
      <div style="margin-top: 10px;">
        <span class="calc-section-label">Included Colors</span><br>
        <span class="calc-pill">All Baseline Pigments</span>
        <span class="calc-pill">Pre-Mixed PMS Colors</span>
        <span class="calc-pill">Extenders & OPVs</span>
        <span class="calc-pill">Opaque White</span>
      </div>
      <div style="margin-top: 10px;">
        <span class="calc-section-label">Excluded ‚Äî Transactional Only</span><br>
        <span class="calc-pill calc-pill-excluded">Fluorescents</span>
        <span class="calc-pill calc-pill-excluded">Metallics</span>
        <span class="calc-pill calc-pill-excluded">UV/LED Systems</span>
        <span class="calc-pill calc-pill-excluded">Specialty Pigments</span>
      </div>
    </div>

    <!-- Customer Type Toggle -->
    <div class="calc-card">
      <h3>Customer Type</h3>
      <div class="toggle-container">
        <button class="toggle-btn active" id="toggleExisting" onclick="setCustomerMode('existing')">Existing Customer</button>
        <button class="toggle-btn" id="toggleNew" onclick="setCustomerMode('new')">New Customer (Estimate)</button>
      </div>
      <div class="calc-muted" style="margin-top: 10px;">
        <span id="modeDescription">Use historical purchase data from this account.</span>
      </div>
    </div>

    <!-- Customer Info (Always Shown) -->
    <div class="calc-card">
      <h3>Customer Information</h3>
      <div class="calc-grid">
        <div class="calc-field">
          <label class="calc-label" for="customerName">Customer Name</label>
          <input class="calc-input" id="customerName" type="text" placeholder="e.g., ABC Printing Co.">
        </div>
        <div class="calc-field">
          <label class="calc-label" for="inkSystem">Primary Ink System</label>
          <select class="calc-select" id="inkSystem">
            <option value="paper">Paper Series</option>
            <option value="thermal">Direct/Indirect Thermal</option>
            <option value="laminating">Laminating Films</option>
            <option value="mixed">Mixed Systems</option>
          </select>
        </div>
      </div>
    </div>

    <!-- EXISTING CUSTOMER INPUTS -->
    <div class="calc-card customer-mode-section active" id="existingCustomerSection">
      <h3>Historical Data (Existing Customer)</h3>
      <div class="calc-grid">
        <div class="calc-field">
          <label class="calc-label" for="historicalAnnual">Historical Annual Purchases ($)</label>
          <input class="calc-input" id="historicalAnnual" type="text" inputmode="decimal" placeholder="e.g., 120000" value="120000">
          <div class="calc-muted">What they paid us last 12 months (eligible systems only)</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="historicalMargin">Historical Margin on Account (%)</label>
          <input class="calc-input" id="historicalMargin" type="number" min="10" max="70" step="0.5" value="42">
          <div class="calc-muted">Actual margin we made on their purchases</div>
        </div>
      </div>
    </div>

    <!-- NEW CUSTOMER INPUTS -->
    <div class="calc-card customer-mode-section" id="newCustomerSection">
      <h3>Estimate Inputs (New Customer)</h3>
      <div class="calc-info" style="margin-top: 0; margin-bottom: 16px;">
        No historical data ‚Äî estimate based on their production profile or competitor spend.
      </div>
      
      <div class="calc-section-label">Option A: Estimate from Production Profile</div>
      <div class="calc-grid-4">
        <div class="calc-field">
          <label class="calc-label" for="numPresses">Number of Presses</label>
          <input class="calc-input" id="numPresses" type="number" min="1" max="50" value="2">
        </div>
        <div class="calc-field">
          <label class="calc-label" for="pressWidth">Avg Press Width (inches)</label>
          <input class="calc-input" id="pressWidth" type="number" min="4" max="80" value="17">
        </div>
        <div class="calc-field">
          <label class="calc-label" for="shiftsPerDay">Shifts per Day</label>
          <select class="calc-select" id="shiftsPerDay">
            <option value="1">1 Shift</option>
            <option value="2" selected>2 Shifts</option>
            <option value="3">3 Shifts</option>
          </select>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="daysPerWeek">Days per Week</label>
          <select class="calc-select" id="daysPerWeek">
            <option value="5" selected>5 Days</option>
            <option value="6">6 Days</option>
            <option value="7">7 Days</option>
          </select>
        </div>
      </div>
      <div class="calc-grid">
        <div class="calc-field">
          <label class="calc-label" for="productType">Primary Product Type</label>
          <select class="calc-select" id="productType">
            <option value="labels">Labels (light coverage)</option>
            <option value="flexible" selected>Flexible Packaging (medium coverage)</option>
            <option value="heavycoverage">Heavy Coverage / Solids</option>
          </select>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="estimatedFromProfile">Estimated Annual Spend (calculated)</label>
          <input class="calc-input" id="estimatedFromProfile" type="text" readonly disabled>
          <div class="calc-muted">Based on industry benchmarks</div>
        </div>
      </div>
      
      <div class="calc-divider"></div>
      
      <div class="calc-section-label">Option B: Competitor Spend Conversion</div>
      <div class="calc-grid">
        <div class="calc-field">
          <label class="calc-label" for="competitorSpend">Current Annual Spend with Competitor ($)</label>
          <input class="calc-input" id="competitorSpend" type="text" inputmode="decimal" placeholder="e.g., 100000">
          <div class="calc-muted">What they're paying another supplier</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="priceComparison">Our Pricing vs Competitor</label>
          <select class="calc-select" id="priceComparison">
            <option value="0.85">We're ~15% cheaper</option>
            <option value="0.90">We're ~10% cheaper</option>
            <option value="0.95">We're ~5% cheaper</option>
            <option value="1.00" selected>About the same</option>
            <option value="1.05">We're ~5% higher</option>
            <option value="1.10">We're ~10% higher</option>
          </select>
        </div>
      </div>
      
      <div class="calc-divider"></div>
      
      <div class="calc-section-label">Option C: Direct COGS-Based Sizing</div>
      <div class="calc-grid">
        <div class="calc-field">
          <label class="calc-label" for="directMonthlyCOGS">Monthly COGS We're Willing to Commit ($)</label>
          <input class="calc-input" id="directMonthlyCOGS" type="text" inputmode="decimal" placeholder="e.g., 5000">
          <div class="calc-muted">Start from what we'll ship, work backward to price</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="useDirectCOGS">Use Direct COGS Method?</label>
          <select class="calc-select" id="useDirectCOGS">
            <option value="no" selected>No ‚Äî Use Profile/Competitor Estimate</option>
            <option value="yes">Yes ‚Äî Use Direct COGS Entry</option>
          </select>
        </div>
      </div>
      
      <div class="calc-divider"></div>
      
      <div class="calc-field">
        <label class="calc-label" for="newTargetMargin">Target Margin for New Account (%)</label>
        <input class="calc-input" id="newTargetMargin" type="number" min="20" max="60" step="0.5" value="40" style="max-width: 200px;">
        <div class="calc-muted">Since no historical margin, set your target</div>
      </div>
      
      <div class="calc-field">
        <label class="calc-label">Estimation Notes</label>
        <textarea class="calc-input" id="estimationNotes" rows="3" placeholder="Document assumptions, source of competitor info, etc."></textarea>
      </div>
    </div>

    <!-- Subscription Pricing Inputs -->
    <div class="calc-card">
      <h3>Subscription Terms</h3>
      <div class="calc-grid-3">
        <div class="calc-field">
          <label class="calc-label" for="subscriptionDiscount">Customer Discount vs Base (%)</label>
          <input class="calc-input" id="subscriptionDiscount" type="number" min="0" max="25" step="0.5" value="10">
          <div class="calc-muted">Savings we're offering. Typical: 8-15%</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="targetMargin">Target Subscription Margin (%)</label>
          <input class="calc-input" id="targetMargin" type="number" min="10" max="70" step="0.5" value="38">
          <div class="calc-muted">Desired margin (existing customers only)</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="contractTerm">Contract Term (months)</label>
          <input class="calc-input" id="contractTerm" type="number" min="1" max="60" step="1" value="12">
          <div class="calc-muted">Length of subscription commitment</div>
        </div>
      </div>
    </div>

    <!-- Overage Controls -->
    <div class="calc-card">
      <h3>Overage Controls & Limits</h3>
      <div class="calc-muted" style="margin-bottom: 14px;">
        Protect against customers ordering significantly more than their subscription covers.
      </div>
      <div class="calc-grid-3">
        <div class="calc-field">
          <label class="calc-label" for="toleranceBand">Soft Cap Tolerance (¬±%)</label>
          <input class="calc-input" id="toleranceBand" type="number" min="5" max="30" step="1" value="15">
          <div class="calc-muted">Acceptable variance before conversation</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="hardCapMultiplier">Hard Cap Multiplier (x)</label>
          <input class="calc-input" id="hardCapMultiplier" type="number" min="1.2" max="3" step="0.1" value="1.5">
          <div class="calc-muted">Max COGS = ceiling √ó this (e.g., 1.5x)</div>
        </div>
        <div class="calc-field">
          <label class="calc-label" for="overageRate">Overage Rate (% markup on COGS)</label>
          <input class="calc-input" id="overageRate" type="number" min="20" max="100" step="5" value="50">
          <div class="calc-muted">What we charge beyond hard cap</div>
        </div>
      </div>
      
      <div class="calc-divider"></div>
      
      <div class="calc-section-label">Escalation Path (Monthly Review)</div>
      <div class="escalation-timeline">
        <div class="escalation-step">
          <div class="escalation-step-title">Month 1 Over Soft Cap</div>
          <div class="escalation-step-action">Internal flag. Monitor next month. No customer contact yet.</div>
        </div>
        <div class="escalation-step warning">
          <div class="escalation-step-title">Month 2 Consecutive</div>
          <div class="escalation-step-action">Notify customer. "Usage trending high ‚Äî let's review fit."</div>
        </div>
        <div class="escalation-step danger">
          <div class="escalation-step-title">Month 3+ or Hard Cap Hit</div>
          <div class="escalation-step-action">Formal adjustment. Re-price subscription or bill overages.</div>
        </div>
      </div>
    </div>

    <!-- Customer-Facing Numbers -->
    <div class="calc-card">
      <h3>Customer-Facing Pricing</h3>
      <div class="calc-section-label">What we quote the customer</div>
      <div class="calc-result-4">
        <div class="calc-kpi calc-kpi-customer">
          <div class="calc-kpi-label">Monthly Subscription</div>
          <div class="calc-kpi-value" id="monthlyPrice">$0</div>
        </div>
        <div class="calc-kpi calc-kpi-customer">
          <div class="calc-kpi-label">Annual Subscription</div>
          <div class="calc-kpi-value" id="annualPrice">$0</div>
        </div>
        <div class="calc-kpi calc-kpi-customer">
          <div class="calc-kpi-label">Customer Savings</div>
          <div class="calc-kpi-value" id="annualSavings">$0</div>
          <div class="calc-kpi-sub" id="savingsPercent">/year</div>
        </div>
        <div class="calc-kpi calc-kpi-customer">
          <div class="calc-kpi-label">Contract Value</div>
          <div class="calc-kpi-value" id="contractValue">$0</div>
          <div class="calc-kpi-sub" id="contractTermDisplay">12-month term</div>
        </div>
      </div>
    </div>

    <!-- Internal COGS & Margin -->
    <div class="calc-card">
      <h3>Internal COGS & Margin Analysis</h3>
      <div class="calc-section-label">Our actual economics</div>
      <div class="calc-result-4">
        <div class="calc-kpi calc-kpi-internal">
          <div class="calc-kpi-label" id="cogsLabel">Historical COGS (Annual)</div>
          <div class="calc-kpi-value" id="annualCOGS">$0</div>
          <div class="calc-kpi-sub">Raw materials basis</div>
        </div>
        <div class="calc-kpi calc-kpi-internal">
          <div class="calc-kpi-label">Monthly COGS Ceiling</div>
          <div class="calc-kpi-value" id="cogsCeiling">$0</div>
          <div class="calc-kpi-sub" id="cogsRange">Soft cap range</div>
        </div>
        <div class="calc-kpi calc-kpi-profit">
          <div class="calc-kpi-label">Expected Gross Profit</div>
          <div class="calc-kpi-value" id="expectedProfit">$0</div>
          <div class="calc-kpi-sub">/year at projected COGS</div>
        </div>
        <div class="calc-kpi calc-kpi-profit">
          <div class="calc-kpi-label">Effective Margin</div>
          <div class="calc-kpi-value" id="effectiveMargin">0%</div>
          <div class="calc-kpi-sub" id="marginDelta"></div>
        </div>
      </div>
      
      <div class="calc-divider"></div>
      
      <div class="calc-section-label">Overage Thresholds</div>
      <div class="calc-result-3">
        <div class="calc-kpi">
          <div class="calc-kpi-label">Soft Cap (Monthly COGS)</div>
          <div class="calc-kpi-value" id="softCapDisplay">$0</div>
          <div class="calc-kpi-sub">Triggers monitoring</div>
        </div>
        <div class="calc-kpi calc-kpi-warning">
          <div class="calc-kpi-label">Hard Cap (Monthly COGS)</div>
          <div class="calc-kpi-value" id="hardCapDisplay">$0</div>
          <div class="calc-kpi-sub">Triggers overage billing</div>
        </div>
        <div class="calc-kpi calc-kpi-warning">
          <div class="calc-kpi-label">Overage Rate</div>
          <div class="calc-kpi-value" id="overageRateDisplay">$0</div>
          <div class="calc-kpi-sub">Per $1 COGS over hard cap</div>
        </div>
      </div>
    </div>

    <!-- Scenario Analysis -->
    <div class="calc-card">
      <h3>Scenario Analysis ‚Äî What If COGS Varies?</h3>
      <div class="calc-muted" style="margin-bottom: 12px;">
        Based on actual raw material shipments. Shows how margin changes and when overages kick in.
      </div>
      <table class="scenario-table">
        <thead>
          <tr>
            <th>Scenario</th>
            <th>Monthly COGS</th>
            <th>Annual COGS</th>
            <th>Gross Profit</th>
            <th>Margin</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="scenarioBody">
        </tbody>
      </table>
    </div>

    <!-- Talking Points -->
    <div class="calc-card">
      <h3>Customer Talking Points</h3>
      <div class="calc-info">
        <b>How to explain this to the customer:</b><br><br>
        "Your subscription is <b id="talkMonthly">$X</b>/month ‚Äî that's <b id="talkDiscount">10%</b> less than <span id="talkBasis">what you spent last year</span>. You get unlimited baseline and PMS colors in <span id="talkSystem">Paper Series</span>. No per-pound tracking, no surprises.<br><br>
        The subscription covers your normal usage. If your business grows significantly and you're consistently using more, we'll work together to adjust the subscription to match. For any unexpected spikes well beyond your normal range, we'd bill those separately at our standard rates."
      </div>
      <div style="margin-top: 14px;">
        <span class="calc-section-label">What's Included</span>
        <ul style="margin: 8px 0; padding-left: 20px; color: #aaa; font-size: 13px; line-height: 1.8;">
          <li>All baseline pigments (Rubine, Yellow, Warm Red, Black, Process Blue, Green, Violet)</li>
          <li>All pre-mixed PMS colors in their ink system</li>
          <li>Extenders, OPVs, and Opaque White</li>
          <li>Flat monthly pricing ‚Äî no per-pound tracking</li>
        </ul>
      </div>
      <div style="margin-top: 10px;">
        <span class="calc-section-label">What's NOT Included (bill separately)</span>
        <ul style="margin: 8px 0; padding-left: 20px; color: #aaa; font-size: 13px; line-height: 1.8;">
          <li>Fluorescents, Metallics, Specialty Pigments</li>
          <li>Ink systems outside their primary system</li>
          <li>UV/LED systems</li>
          <li>Usage beyond hard cap (billed at overage rate)</li>
        </ul>
      </div>
    </div>

    <!-- Export Notes -->
    <div class="calc-card">
      <h3>Export ‚Äî Internal Documentation</h3>
      <div class="calc-section-label">Copy to CRM / Deal Notes</div>
      <div class="copy-output" id="internalSummary">Loading...</div>
      <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="calc-btn" onclick="copyInternalSummary()">Copy to Clipboard</button>
        <button class="calc-btn calc-btn-secondary" onclick="downloadSummary()">Download as .txt</button>
      </div>
    </div>

  </div>

  <script>
    // State
    let customerMode = 'existing'; // 'existing' or 'new'
    
    function $(id) { return document.getElementById(id); }
    
    function formatUSD(n) {
      if (!isFinite(n)) n = 0;
      return n.toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
    }
    
    function parseMoney(v) {
      const cleaned = String(v || '').replace(/[^0-9.]/g, '');
      const num = parseFloat(cleaned);
      return isFinite(num) ? num : 0;
    }
    
    function setCustomerMode(mode) {
      customerMode = mode;
      
      // Update toggle buttons
      $('toggleExisting').classList.toggle('active', mode === 'existing');
      $('toggleNew').classList.toggle('active', mode === 'new');
      
      // Update sections
      $('existingCustomerSection').classList.toggle('active', mode === 'existing');
      $('newCustomerSection').classList.toggle('active', mode === 'new');
      
      // Update description
      $('modeDescription').textContent = mode === 'existing' 
        ? 'Use historical purchase data from this account.'
        : 'Estimate subscription size for a prospect with no purchase history.';
      
      // Enable/disable target margin field (only for existing)
      $('targetMargin').disabled = (mode === 'new');
      
      calculate();
    }
    
    function estimateFromProfile() {
      const numPresses = parseInt($('numPresses').value) || 1;
      const pressWidth = parseInt($('pressWidth').value) || 17;
      const shiftsPerDay = parseInt($('shiftsPerDay').value) || 2;
      const daysPerWeek = parseInt($('daysPerWeek').value) || 5;
      const productType = $('productType').value;
      
      // Base ink consumption: lbs per inch of press width per shift
      // Industry rough estimate: 0.5-2 lbs per inch per shift depending on coverage
      let lbsPerInchPerShift;
      switch (productType) {
        case 'labels': lbsPerInchPerShift = 0.4; break;
        case 'flexible': lbsPerInchPerShift = 0.8; break;
        case 'heavycoverage': lbsPerInchPerShift = 1.4; break;
        default: lbsPerInchPerShift = 0.8;
      }
      
      // Annual lbs = presses √ó width √ó lbs/inch/shift √ó shifts √ó days √ó weeks
      const annualLbs = numPresses * pressWidth * lbsPerInchPerShift * shiftsPerDay * daysPerWeek * 50;
      
      // Assume average price per lb of $8-12 depending on mix
      const pricePerLb = 10;
      const estimatedAnnual = annualLbs * pricePerLb;
      
      return estimatedAnnual;
    }
    
    function calculate() {
      // Common inputs
      const customerName = $('customerName').value || 'Customer';
      const inkSystem = $('inkSystem').value;
      const inkSystemLabel = $('inkSystem').options[$('inkSystem').selectedIndex].text;
      const subscriptionDiscount = Math.max(0, Math.min(25, parseFloat($('subscriptionDiscount').value) || 0));
      const contractTermMonths = Math.max(1, parseInt($('contractTerm').value) || 12);
      const toleranceBand = Math.max(5, Math.min(30, parseFloat($('toleranceBand').value) || 15));
      const hardCapMultiplier = Math.max(1.2, Math.min(3, parseFloat($('hardCapMultiplier').value) || 1.5));
      const overageRatePct = Math.max(20, Math.min(100, parseFloat($('overageRate').value) || 50));
      
      let baseAnnual = 0;       // What we base the subscription on (customer's spend or estimated)
      let annualCOGS = 0;       // Our cost of goods
      let effectiveMargin = 0;  // What margin we'll make
      let historicalMargin = 0;
      let isEstimate = false;
      let estimationMethod = '';
      
      if (customerMode === 'existing') {
        // EXISTING CUSTOMER
        baseAnnual = parseMoney($('historicalAnnual').value);
        historicalMargin = Math.max(10, Math.min(70, parseFloat($('historicalMargin').value) || 42));
        const targetMargin = Math.max(10, Math.min(70, parseFloat($('targetMargin').value) || 38));
        
        annualCOGS = baseAnnual * (1 - historicalMargin / 100);
        
        const annualSubscription = baseAnnual * (1 - subscriptionDiscount / 100);
        effectiveMargin = annualSubscription > 0 ? ((annualSubscription - annualCOGS) / annualSubscription) * 100 : 0;
        
        $('cogsLabel').textContent = 'Historical COGS (Annual)';
        $('marginDelta').textContent = `vs ${historicalMargin.toFixed(1)}% historical`;
        
      } else {
        // NEW CUSTOMER
        isEstimate = true;
        const newTargetMargin = Math.max(20, Math.min(60, parseFloat($('newTargetMargin').value) || 40));
        const useDirectCOGS = $('useDirectCOGS').value === 'yes';
        
        if (useDirectCOGS) {
          // Direct COGS method
          const directMonthlyCOGS = parseMoney($('directMonthlyCOGS').value);
          annualCOGS = directMonthlyCOGS * 12;
          // Work backward: subscription = COGS / (1 - margin)
          baseAnnual = annualCOGS / (1 - newTargetMargin / 100);
          estimationMethod = 'Direct COGS entry';
        } else {
          // Profile or competitor method
          const competitorSpend = parseMoney($('competitorSpend').value);
          const priceComparison = parseFloat($('priceComparison').value) || 1.0;
          
          if (competitorSpend > 0) {
            // Use competitor spend
            baseAnnual = competitorSpend * priceComparison;
            estimationMethod = 'Competitor spend conversion';
          } else {
            // Use profile estimate
            baseAnnual = estimateFromProfile();
            estimationMethod = 'Production profile estimate';
          }
          
          annualCOGS = baseAnnual * (1 - newTargetMargin / 100);
        }
        
        effectiveMargin = newTargetMargin;
        
        $('cogsLabel').textContent = 'Estimated COGS (Annual)';
        $('marginDelta').textContent = `target margin for new account`;
        
        // Update profile estimate display
        $('estimatedFromProfile').value = formatUSD(estimateFromProfile());
      }
      
      // Calculate subscription pricing
      const annualSubscription = baseAnnual * (1 - subscriptionDiscount / 100);
      const monthlySubscription = annualSubscription / 12;
      const annualSavings = baseAnnual - annualSubscription;
      const contractValue = monthlySubscription * contractTermMonths;
      
      // COGS calculations
      const monthlyCOGSCeiling = annualCOGS / 12;
      const softCap = monthlyCOGSCeiling * (1 + toleranceBand / 100);
      const hardCap = monthlyCOGSCeiling * hardCapMultiplier;
      const cogsLow = monthlyCOGSCeiling * (1 - toleranceBand / 100);
      
      // Profit
      const expectedAnnualProfit = annualSubscription - annualCOGS;
      const actualEffectiveMargin = annualSubscription > 0 ? (expectedAnnualProfit / annualSubscription) * 100 : 0;
      
      // Update displays
      $('monthlyPrice').textContent = formatUSD(monthlySubscription);
      $('annualPrice').textContent = formatUSD(annualSubscription);
      $('annualSavings').textContent = formatUSD(annualSavings);
      $('savingsPercent').textContent = subscriptionDiscount.toFixed(1) + '% savings/year';
      $('contractValue').textContent = formatUSD(contractValue);
      $('contractTermDisplay').textContent = contractTermMonths + '-month term';
      
      $('annualCOGS').textContent = formatUSD(annualCOGS);
      $('cogsCeiling').textContent = formatUSD(monthlyCOGSCeiling);
      $('cogsRange').textContent = `¬±${toleranceBand}%: ${formatUSD(cogsLow)} - ${formatUSD(softCap)}`;
      $('expectedProfit').textContent = formatUSD(expectedAnnualProfit);
      $('effectiveMargin').textContent = actualEffectiveMargin.toFixed(1) + '%';
      
      $('softCapDisplay').textContent = formatUSD(softCap);
      $('hardCapDisplay').textContent = formatUSD(hardCap);
      $('overageRateDisplay').textContent = '$' + (1 + overageRatePct / 100).toFixed(2);
      
      // Talking points
      $('talkMonthly').textContent = formatUSD(monthlySubscription);
      $('talkDiscount').textContent = subscriptionDiscount.toFixed(0) + '%';
      $('talkSystem').textContent = inkSystemLabel;
      $('talkBasis').textContent = isEstimate ? 'comparable accounts in your industry' : 'what you spent last year';
      
      // Scenario table
      const scenarios = [
        { label: 'COGS -30%', factor: 0.70 },
        { label: 'COGS -20%', factor: 0.80 },
        { label: 'As Projected', factor: 1.00 },
        { label: 'COGS +15% (soft cap)', factor: 1 + toleranceBand / 100 },
        { label: 'COGS +' + ((hardCapMultiplier - 1) * 100).toFixed(0) + '% (hard cap)', factor: hardCapMultiplier },
        { label: 'COGS +75%', factor: 1.75 },
        { label: 'COGS +100% (2x)', factor: 2.00 },
      ];
      
      let scenarioHTML = '';
      scenarios.forEach(s => {
        const monthCOGS = monthlyCOGSCeiling * s.factor;
        const annCOGS = monthCOGS * 12;
        
        // Calculate profit including potential overage charges
        let profit = annualSubscription - annCOGS;
        let overageNote = '';
        
        if (monthCOGS > hardCap) {
          const monthlyOverage = monthCOGS - hardCap;
          const annualOverage = monthlyOverage * 12;
          const overageRevenue = annualOverage * (overageRatePct / 100);
          profit += overageRevenue;
          overageNote = ` (+${formatUSD(overageRevenue)} overage)`;
        }
        
        const margin = annualSubscription > 0 ? (profit / annualSubscription) * 100 : 0;
        
        let status = '‚úì OK';
        let rowClass = '';
        if (s.factor === 1.00) {
          rowClass = 'highlight';
          status = '‚óè Baseline';
        } else if (monthCOGS > hardCap) {
          status = 'üõë Overage Billing';
          rowClass = 'danger';
        } else if (monthCOGS > softCap) {
          status = '‚ö†Ô∏è Escalation';
          rowClass = 'warning';
        } else if (s.factor < 1) {
          status = '‚úì Under';
        }
        
        scenarioHTML += `
          <tr class="${rowClass}">
            <td>${s.label}</td>
            <td>${formatUSD(monthCOGS)}</td>
            <td>${formatUSD(annCOGS)}</td>
            <td>${formatUSD(profit)}${overageNote}</td>
            <td>${margin.toFixed(1)}%</td>
            <td>${status}</td>
          </tr>
        `;
      });
      $('scenarioBody').innerHTML = scenarioHTML;
      
      // Internal summary
      const estimationNotes = customerMode === 'new' ? ($('estimationNotes').value || 'None provided') : 'N/A';
      
      const internalSummary = `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
INK SUBSCRIPTION ‚Äî INTERNAL PRICING DOCUMENTATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

CUSTOMER: ${customerName}
DATE: ${new Date().toLocaleDateString()}
INK SYSTEM: ${inkSystemLabel}
CUSTOMER TYPE: ${customerMode === 'existing' ? 'Existing Customer' : 'New Customer (Estimate)'}
${customerMode === 'new' ? `ESTIMATION METHOD: ${estimationMethod}` : ''}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
CUSTOMER-FACING PRICING
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Monthly Subscription:     ${formatUSD(monthlySubscription)}
Annual Subscription:      ${formatUSD(annualSubscription)}
Contract Term:            ${contractTermMonths} months
Total Contract Value:     ${formatUSD(contractValue)}

Customer Savings:         ${formatUSD(annualSavings)}/year (${subscriptionDiscount.toFixed(1)}% discount)
vs Base Annual:           ${formatUSD(baseAnnual)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
INTERNAL ECONOMICS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${customerMode === 'existing' ? `Historical Margin:        ${historicalMargin.toFixed(1)}%` : `Target Margin:            ${effectiveMargin.toFixed(1)}%`}
Annual COGS:              ${formatUSD(annualCOGS)}
Monthly COGS Baseline:    ${formatUSD(monthlyCOGSCeiling)}

Effective Margin:         ${actualEffectiveMargin.toFixed(1)}%
Expected Gross Profit:    ${formatUSD(expectedAnnualProfit)}/year

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
OVERAGE CONTROLS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Soft Cap (triggers review):   ${formatUSD(softCap)}/month (+${toleranceBand}%)
Hard Cap (triggers billing):  ${formatUSD(hardCap)}/month (${hardCapMultiplier}x baseline)
Overage Rate:                 ${overageRatePct}% markup on COGS beyond hard cap

ESCALATION PATH:
‚Ä¢ Month 1 over soft cap ‚Üí Internal flag, monitor
‚Ä¢ Month 2 consecutive  ‚Üí Customer notification
‚Ä¢ Month 3+ or hard cap ‚Üí Formal adjustment or overage billing

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
MONTHLY REVIEW CHECKLIST
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ñ° Pull raw material shipments from production system
‚ñ° Compare to COGS ceiling: ${formatUSD(monthlyCOGSCeiling)}
‚ñ° Flag if over soft cap: ${formatUSD(softCap)}
‚ñ° Bill overages if over hard cap: ${formatUSD(hardCap)}
‚ñ° Update CRM with usage trend notes

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
INCLUDED IN SUBSCRIPTION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚úì All baseline pigments
‚úì All pre-mixed PMS colors in ${inkSystemLabel}
‚úì Extenders, OPVs, Opaque White

NOT INCLUDED:
‚úó Fluorescents, Metallics, Specialty Pigments
‚úó UV/LED systems
‚úó Ink systems outside ${inkSystemLabel}
‚úó Usage beyond hard cap (billed at overage rate)

${customerMode === 'new' ? `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
ESTIMATION NOTES
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${estimationNotes}
` : ''}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`;

      $('internalSummary').textContent = internalSummary;
    }
    
    function copyInternalSummary() {
      navigator.clipboard.writeText($('internalSummary').textContent).then(() => {
        alert('Copied to clipboard');
      });
    }
    
    function downloadSummary() {
      const text = $('internalSummary').textContent;
      const customerName = $('customerName').value || 'Customer';
      const filename = `Ink-Subscription-${customerName.replace(/[^a-zA-Z0-9]/g, '-')}-${new Date().toISOString().split('T')[0]}.txt`;
      
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Event listeners for existing customer fields
    ['customerName', 'inkSystem', 'historicalAnnual', 'historicalMargin', 'subscriptionDiscount', 
     'targetMargin', 'contractTerm', 'toleranceBand', 'hardCapMultiplier', 'overageRate'].forEach(id => {
      const elem = $(id);
      if (elem) {
        const event = elem.tagName === 'SELECT' ? 'change' : 'input';
        elem.addEventListener(event, calculate);
      }
    });
    
    // Event listeners for new customer fields
    ['numPresses', 'pressWidth', 'shiftsPerDay', 'daysPerWeek', 'productType', 
     'competitorSpend', 'priceComparison', 'directMonthlyCOGS', 'useDirectCOGS', 
     'newTargetMargin', 'estimationNotes'].forEach(id => {
      const elem = $(id);
      if (elem) {
        const event = elem.tagName === 'SELECT' ? 'change' : 'input';
        elem.addEventListener(event, calculate);
      }
    });
    
    // Initial calculation
    calculate();
  </script>
</body>
</html>
